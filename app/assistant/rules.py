"""
Rule-based knowledge sources for the assistant.
ALL responses come ONLY from these sources. Traceable and explainable.
"""

# Intent keywords. Order matters: first match wins.
# Priority: lesson_explanation > lesson_errors > sentence_check > error_explanation > vocabulary > grammar > general_help > unknown
INTENT_PATTERNS: dict[str, list[str]] = {
    "lesson_explanation": [
        "объясни урок", "объясни этот урок", "объясни 1 урок", "объясни 2 урок", "объясни 3 урок",
        "о чем урок", "о чём урок", "что в уроке", "разбор урока",
        "объясни 1-й урок", "объясни второй урок", "урок 1", "урок 2", "урок 3",
        "что понять в уроке", "что должен понять", "должен понять в уроке",
        "объясни грамматику урока", "грамматика этого урока", "объясни грамматику этого урока",
    ],
    "lesson_errors": [
        "какие ошибки", "ошибки в этом уроке", "ошибки в уроке", "частые ошибки",
        "жии қателер", "жиі қателер", "қателер қандай", "что делают неправильно",
        "что неправильно в уроке", "типичные ошибки",
    ],
    "sentence_check": [
        "проверь", "правильно ли", "исправь", "тексер", "дұрыс па",
        "проверь предложение", "правильно ли написано", "исправь ошибки",
    ],
    "error_explanation": [
        "подскажи", "подсказк", "помоги", "не понимаю", "не получается",
        "ошибся", "неправильно", "почему не", "что не так", "объясни ошибку",
        "почему ошибка", "хинт", "hint",
        "в чём ошибка", "в чем ошибка", "моя ошибка", "почему неправильно",
    ],
    "vocabulary_question": [
        "что значит", "как переводится", "перевод", "значение слова",
        "как будет", "по-казахски", "на казахском", "перевести", "означает",
        "слово ", "что такое ", "перевод слова",
    ],
    "grammar_question": [
        "какие правила", "правила есть", "основные правила", "правила в казахском",
        "грамматик", "правило", "падеж", "септік", "окончание", "жалғау",
        "жұрнақ", "аффикс", "суффикс", "структур",
        "порядок слов", "сөз тәртібі", "подлежащ", "дополнени", "глагол",
        "разница между", "айырмашылығы", "в чём разница", "в чем разница",
        "қалай қолдану", "қашан қолданылады", "неге", "почему", "как сказать",
        "спряжение", "склонение", "существительное",
        "мен", "сен", "сіз", "привет", "формаль", "разница сен", "разница сіз",
    ],
    "general_help": [
        "привет", "здравствуй", "помощь", "помогите", "как ", "что ",
        "сәлем", "приветствую", "добрый", "hi", "hello",
    ],
}

# Grammar Knowledge Base A1 — structured rules with explanation + examples
GRAMMAR_KB: dict[str, dict] = {
    "word_order": {
        "explanation": "В казахском языке порядок слов фиксированный: подлежащее → дополнение → глагол (SOV).",
        "examples": [
            "Мен кітап оқыдым. (Я книгу прочитал.)",
            "Ол сәлем айтты. (Он поздоровался.)",
            "Біз үйде отырмыз. (Мы сидим дома.)",
        ],
    },
    "sen_siz": {
        "explanation": "В казахском есть формальное «сіз» (Вы) и неформальное «сен» (ты). К старшим и незнакомым — «сіз», «-ңыз»/«-ыңыз». К друзьям и младшим — «сен», «-сың»/«-ң».",
        "examples": [
            "Сәлеметсіз бе — формальное приветствие (здравствуйте).",
            "Сәлем — неформальное (привет).",
            "Қалыңыз қалай? — как дела? (формально).",
        ],
    },
    "present_endings": {
        "explanation": "Настоящее время: корень + личное окончание. 1-е лицо: -мын/-мін; 2-е (ты): -сың/-сің; 2-е (Вы): -сыз/-сіз; 3-е: -ды/-ді.",
        "examples": [
            "Мен оқушымын. (Я ученик.)",
            "Сен студентсің. (Ты студент.)",
            "Ол мұғалім. (Он/она учитель.)",
        ],
    },
    "plural": {
        "explanation": "Множественное число: -лар/-лер (после согласных и а, ы, о, у), -дар/-дер/-тар/-тер (после звонких/глухих).",
        "examples": [
            "кітап → кітаптар (книги)",
            "үй → үйлер (дома)",
            "бала → балалар (дети)",
        ],
    },
    "question_particles": {
        "explanation": "Вопрос в казахском: частица «ма/ме/ба/бе/па/пе» в конце предложения или вопросительная интонация.",
        "examples": [
            "Сәлеметсіз бе? — Здравствуйте? (вопрос-приветствие)",
            "Қалайсыз? — Как вы?",
        ],
    },
    "cases_intro": {
        "explanation": "Падежи (септіктер): именительный (бастау), дательный (-ға/-ге), местный (-да/-де), винительный (-ны/-ні).",
        "examples": [
            "үй (дом) → үйге (в дом, дат.) → үйде (в доме, местн.)",
            "кітап (книга) → кітапты (книгу, вин.)",
        ],
    },
    "negation_intro": {
        "explanation": "Отрицание: «емес» (не) после существительного, «жоқ» (нет).",
        "examples": [
            "Мен студент емеспін. (Я не студент.)",
            "Кітап жоқ. (Книги нет.)",
        ],
    },
    "affixes": {
        "explanation": "Казахский — агглютинативный язык. Слова строятся из корня + аффиксов (жалғаулар).",
        "examples": [
            "үй (дом) → үйде (в доме), үйге (в дом), үйлер (дома)",
            "оқу (читать) → оқулық (учебник), оқушы (ученик)",
        ],
    },
}

# Legacy A1_GRAMMAR_RULES for backward compatibility (maps to GRAMMAR_KB)
A1_GRAMMAR_RULES: dict[str, dict] = {
    "word_order": {"explanation": GRAMMAR_KB["word_order"]["explanation"], "example": GRAMMAR_KB["word_order"]["examples"][0]},
    "affixes": {"explanation": GRAMMAR_KB["affixes"]["explanation"], "example": GRAMMAR_KB["affixes"]["examples"][0]},
    "formal_informal": {"explanation": GRAMMAR_KB["sen_siz"]["explanation"], "example": GRAMMAR_KB["sen_siz"]["examples"][0]},
    "sen_siz": {"explanation": GRAMMAR_KB["sen_siz"]["explanation"], "example": GRAMMAR_KB["sen_siz"]["examples"][0]},
    "present_tense": {"explanation": GRAMMAR_KB["present_endings"]["explanation"], "example": GRAMMAR_KB["present_endings"]["examples"][0]},
    "default": {
        "explanation": "Посмотрите раздел «Грамматика» в уроке. Там правило и примеры.",
        "example": "В уроке есть блок «Грамматикалық нүкте».",
    },
}

# Context-based restrictions
TEST_MODE_RESPONSE = (
    "Во время теста я объясняю только правила, не даю ответов. "
    "Вспомните материал урока. Обратите внимание на окончания."
)

# Fallback: never look "dumb", always suggest concrete actions
FALLBACK = (
    "Я могу:\n"
    "– объяснить урок (цель, грамматика, примеры)\n"
    "– объяснить грамматику (порядок слов, сіз/сен, окончания)\n"
    "– показать частые ошибки урока\n"
    "– перевести отдельное слово\n\n"
    "Задайте вопрос, например: «Объясни этот урок» или «Какие ошибки в этом уроке?»"
)
