# Virtual Assistant QA Test Report

## Test Environment
- **Date:** 2025-02-07
- **Method:** Black-box testing via `process_message` API
- **Context variations:** free, lesson, test, vocabulary

---

## Detailed Test Results

### A) Vocabulary Questions

| # | Question | Context | Assistant Answer | Evaluation |
|---|----------|---------|------------------|------------|
| 1 | Что значит слово «сәлем»? | free | Из словаря платформы: «сөз» — слово. Можете добавить в личный словарь... | **Incorrect** — возвращает «сөз» (слово) вместо «сәлем» (привет). Ошибка извлечения слова: берётся «слово», а не «сәлем». |
| 2 | Как переводится «рахмет»? | free | Слово ««рахмет»?» не найдено в словаре... | **Incorrect** — в словаре «рақмет» (с қ), вариант «рахмет» не распознаётся. В извлечённом слове есть лишние ««»?». |
| 3 | Что означает «ана»? | free | Слово ««ана»?» не найдено... | **Incorrect** — в словаре есть «ана» (мать). Извлечение захватывает кавычки и «?». |
| 4 | Перевод слова жақсы | free | Из словаря платформы: «жақсы» — хороший. Можете добавить... | **Correct** — корректный перевод. Использует vocabulary data: YES. |
| 5 | Что значит сәлем? | vocabulary | Из словаря платформы: «сәлемдесу» — приветствовать... | **Partially correct** — похожее слово «сәлемдесу», а нужен «сәлем». При неоднозначности возвращается первое совпадение. |
| 6 | Что значит сәлем? | test | Во время теста я объясняю только правила, не даю ответов... | **Correct** — в test mode перевод не выдаётся. |

### B) Grammar Questions

| # | Question | Context | Assistant Answer | Evaluation |
|---|----------|---------|------------------|------------|
| 7 | Почему используется «мен»? | free | Правило грамматики (A1): Посмотрите раздел «Грамматика» в уроке... | **Too generic** — нет объяснения про «мен». Использует grammar rules: YES, но default. |
| 8 | Как сказать «я студент» по-казахски? | free | Укажите слово. Например: «Что значит сәлем?»... | **Incorrect** — воспринимается как vocabulary, но извлекается фраза. Не поддерживает фразы. |
| 9 | В чём разница между «сәлем» и «сәлеметсіз бе»? | free | Я помощник по казахскому языку. Задайте вопрос о конкретном слове... | **Incorrect** — общий ответ. Не распознаётся как vocabulary/comparison. |
| 10 | Объясни правило про окончания | free | Правило грамматики (A1): Казахский — агглютинативный язык. Слова строятся из корня и окончаний. Пример: үй (дом) → үйде... | **Useful** — соответствует правилу affixes. Использует grammar rules: YES. |
| 11 | Какой порядок слов в казахском? | free | Я помощник по казахскому языку. Задайте вопрос о конкретном слове... | **Incorrect** — должен выбираться intent grammar + правило word_order. «Какой» не в паттернах. |

### C) Lesson-Context Questions

| # | Question | Context | Assistant Answer | Evaluation |
|---|----------|---------|------------------|------------|
| 12 | Объясни урок про приветствия | lesson, id=2 | Я помощник... Сейчас вы изучаете урок «Алфавит және дыбысталу»... | **Partially correct** — lesson title используется, но сути урока нет. Uses lesson data: YES (title only). |
| 13 | Что я должен понять в этом уроке? | lesson, id=2 | (тот же ответ) | **Too generic** — не даётся цель урока из content. |
| 14 | Что значит сәлем? | lesson, id=2 | Из словаря платформы: «сәлемдесу» — приветствовать. Урок «...» также содержит это слово... | **Partially correct** — слово неверное (сәлемдесу vs сәлем), но lesson упоминается. |

### D) Error-Explanation Questions

| # | Question | Context | Assistant Answer | Evaluation |
|---|----------|---------|------------------|------------|
| 15 | Почему это неправильно? | free | Правило грамматики (A1): Посмотрите раздел «Грамматика» в уроке... | **Too generic** — нет контекста ошибки. |
| 16 | В чём моя ошибка? | free | Я помогаю объяснять слова, правила грамматики и ошибки из урока... | **Fallback** — intent unknown, т.к. «моя ошибка» не в паттернах. |
| 17 | Подскажи, не понимаю | test | Во время теста я объясняю только правила, не даю ответов... | **Correct** — test mode соблюдён. |
| 18 | Подскажи, не понимаю | lesson, id=2, last_error_type=grammar | Из урока «...» (раздел «Частые ошибки»): Жиі қателер... | **Useful** — используется контент урока. Uses lesson data: YES. |

### E) Out-of-Scope Questions

| # | Question | Context | Assistant Answer | Evaluation |
|---|----------|---------|------------------|------------|
| 19 | Какая погода завтра? | free | Я помощник по казахскому языку. Задайте вопрос о конкретном слове... | **Correct** — отказ от ответа, перенаправление. |
| 20 | Сколько лет президенту Казахстана? | free | Я помогаю объяснять слова, правила грамматики и ошибки из урока... | **Correct** — fallback, корректный отказ. |

### F) General Questions

| # | Question | Context | Assistant Answer | Evaluation |
|---|----------|---------|------------------|------------|
| 21 | Привет | free | Я помощник по казахскому языку. Задайте вопрос о конкретном слове... | **Partially correct** — можно было бы приветствие на казахском. |
| 22 | Помощь | free | (тот же ответ) | **Useful** — инструкция уместна. |

---

## Summary Tables

### Per Question Format (Sample)

**Question:** Что значит слово «сәлем»?

**Context:** free

**Assistant answer:** Из словаря платформы: «сөз» — слово. Можете добавить в личный словарь в разделе «Словарь».

**Evaluation:**
- Correct / Partially correct / **Incorrect**
- Too generic / Useful / **Misleading**
- Uses lesson data? NO
- Uses vocabulary data? YES (but wrong word)

**Comment:** Извлекается слово «слово» вместо «сәлем», поэтому показывается перевод «сөз». Нужна корректная логика парсинга слова в кавычках.

---

## Final Summary

### 1) Strengths

- **Test mode** — не выдаёт ответы на вопросы теста.
- **Lesson content** — при `lesson_id` и `error_explanation` использует раздел «Частые ошибки».
- **Grammar rules** — правило про окончания (affixes) даёт осмысленный ответ.
- **Out-of-scope** — отклоняет непрофильные вопросы.
- **Vocabulary** — при правильном извлечении слова (напр. «жақсы») отвечает корректно.
- **Source attribution** — указывает «Из словаря платформы», «Из урока», «Правило грамматики (A1)».

### 2) Weaknesses

1. **Извлечение слова** — при «слово «X»» берётся «слово», при ««X»?» — с кавычками и «?».
2. **Варианты написания** — «рахмет» vs «рақмет» не учитываются.
3. **Первое совпадение** — при «сәлем» возвращается «сәлемдесу» из‑за порядка в БД.
4. **Intent detection** — «Какой порядок слов» не распознаётся как grammar; «В чём разница», «В чём моя ошибка» не в паттернах.
5. **Фразы** — не поддерживаются запросы вроде «Как сказать «я студент» по-казахски».
6. **Lesson content** — при «Объясни урок» не используется content, только title.
7. **Greeting** — на «Привет» выдаётся общая инструкция вместо приветствия.

### 3) Most Common Failure Reasons

| Причина | Частота | Примеры |
|---------|---------|---------|
| Неверное извлечение слова (кавычки, пунктуация) | Высокая | Тесты 1, 2, 3, 5 |
| Отсутствие паттернов в intent detection | Средняя | Тесты 9, 11, 16 |
| Только первое совпадение в vocabulary | Средняя | Тесты 1, 5, 14 |
| Слишком общие grammar/error ответы | Средняя | Тесты 7, 15 |
| Неиспользование lesson content | Средняя | Тесты 12, 13 |

### 4) Concrete Recommendations

**Logic:**

- Исправить `_extract_word_from_message`: приоритетно брать слово в кавычках «...», убирать пунктуацию.
- Добавить нормализацию: «рахмет»→«рақмет», «салем»→«сәлем».
- При vocabulary lookup выбирать точное совпадение (`word_kz = query`), затем substring.
- Добавить поддержку фраз (fallback на отдельные слова или отказ с пояснением).

**Rules (Intent patterns):**

- Добавить в `grammar_question`: «какой порядок», «порядок слов», «разница между», «в чём разница».
- Добавить в `error_explanation`: «в чём ошибка», «моя ошибка», «почему неправильно», «объясни ошибку».

**Data sources:**

- Подключить извлечение `learning_objective` из lesson content при запросах «что понять», «объясни урок».
- Использовать `grammar_focus` и примеры из урока для grammar_question при наличии `lesson_id`.
- Рассмотреть отдельную таблицу вариантов написания для vocabulary (рақмет/рахмет).

---

## Conclusion

Помощник корректно работает в test mode, умеет использовать раздел «Частые ошибки» урока и словарь при правильном извлечении слова. Основные проблемы — парсинг запроса (кавычки, пунктуация), узкий intent detection и неиспользование lesson content для запросов вроде «объясни урок». После исправлений в логике извлечения и расширения правил поведение станет более предсказуемым и полезным.
